<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Throught the Nightmares - Ghost Flask Demo</title>
    <link rel="shortcut icon" href="GhostFlask/TemplateData/favicon.ico">
    <link rel="stylesheet" href="GhostFlask/TemplateData/style.css">
    <script src="GhostFlask/TemplateData/UnityProgress.js"></script>  
    <script src="GhostFlask/Build/UnityLoader.js"></script>
    <script>
      var gameInstance = UnityLoader.instantiate("gameContainer", "GhostFlask/Build/GhostSandman.json", {onProgress: UnityProgress});
    </script>
  </head>
  <body bgcolor = '1d1d1d'>

  	<h1>Ghost Flask Demo</h1>
  	<p>In the <a href="https://www.facebook.com/SandmanGame" target="_blank">Throught the Nightmares</a> game, it used for showing why player can't place the flask.</p>

<video width="600" autoplay loop controls>
  <source src="GhostFlask/video.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>

<br>
    <div class="webgl-content">
      <div id="gameContainer" style="width: 600px; height: 600px"></div>
      <div class="footer">
        <div class="fullscreen" onclick="gameInstance.SetFullscreen(1)"></div>
      </div>
    </div>
    <h2>Shader code:</h2>
    <textarea readonly>
Shader "Sandman/GhostFlaskWithSandman"
{
	Properties
	{
		_MainTex("Albedo (RGB)", 2D) = "white" {}
		_Animation("Animation", Range(0, 1)) = 0.0
		_AlphaAddition("Alpha Addition", Range(0, 1)) = 0.0
		_FogSpeed("Fog Speed", Range(0, 1)) = 0.0

		_Multiplier("Multiplier", float) = 1
		_NormalColor("Normal Color", Color) = (1,1,1,1)
		_BlockedColor("Blocked Color", Color) = (1,1,1,1)
	}
	SubShader
	{
		Tags { "Queue"="Transparent" "RenderType"="Transparent" }
		Blend SrcAlpha OneMinusSrcAlpha
		ZWrite off
        
		Pass
		{
		//bg
			ZTest Greater

			CGPROGRAM
			#pragma vertex vert
			#pragma fragment frag

			#include "UnityCG.cginc"

			struct appdata
			{
				float4 vertex : POSITION;
				float3 normal : NORMAL;
				float2 uv : TEXCOORD0;
			};

			struct v2f
			{
				float4 vertex : SV_POSITION;
				float3 normal : NORMAL;
				float3 viewDir : TEXCOORD1;
				float2 uv : TEXCOORD0;
			};

		    sampler2D _MainTex;
			float4 _BlockedColor;
			float _AlphaAddition;
			float _Multiplier;
			float _Animation;
			float _FogSpeed;
			float4 _MainTex_ST;

			v2f vert (appdata v)
			{
				v2f o;
				o.vertex = UnityObjectToClipPos(v.vertex);
				o.normal = UnityObjectToWorldNormal(v.normal);
				o.viewDir = normalize(_WorldSpaceCameraPos.xyz - mul(unity_ObjectToWorld, v.vertex).xyz);
				o.uv = TRANSFORM_TEX(v.uv, _MainTex);
				return o;
			}
			
			fixed4 frag (v2f i) : SV_Target
			{
				float alpha = 1 - dot(i.normal, i.viewDir) * _Multiplier;
				float alphaFactor = (tex2D(_MainTex, i.uv + _Time.gg * _FogSpeed).b + _AlphaAddition) * _Animation;
				_BlockedColor.a = alphaFactor * alpha;
				return _BlockedColor;
			}
			ENDCG
		}

		Pass
		{
		//normal
			ZTest LEqual

			CGPROGRAM
			#pragma vertex vert
			#pragma fragment frag

			
			#include "UnityCG.cginc"

			struct appdata
			{
				float4 vertex : POSITION;
				float3 normal : NORMAL;
				float2 uv : TEXCOORD0;
			};


			struct v2f
			{
				float4 vertex : SV_POSITION;
				float3 normal : NORMAL;
				float3 viewDir : TEXCOORD1;
				float2 uv : TEXCOORD0;
			};
			
			sampler2D _MainTex;
			float4 _NormalColor;
			float _Animation;
			float _AlphaAddition;
			float _Multiplier;	
			float _FogSpeed;
			float4 _MainTex_ST;


			v2f vert (appdata v)
			{
				v2f o;
				o.vertex = UnityObjectToClipPos(v.vertex);
				o.normal = UnityObjectToWorldNormal(v.normal);
				o.viewDir = normalize(_WorldSpaceCameraPos.xyz - mul(unity_ObjectToWorld, v.vertex).xyz);
				o.uv = TRANSFORM_TEX(v.uv, _MainTex);
				return o;
			}
			
			fixed4 frag (v2f i) : SV_Target
			{
				float alpha = 1 - dot(i.normal, i.viewDir) * _Multiplier;
				float alphaFactor = (tex2D(_MainTex, i.uv + _Time.gg * _FogSpeed).b + _AlphaAddition) * _Animation;
				_NormalColor.a = alphaFactor * alpha;
				return _NormalColor;
			}
						
			ENDCG
		}
	}
}
	</textarea>

	<p>Our pages in social networks:<br>
		<a href="https://www.facebook.com/SandmanGame/" target="_blank">Facebook</a><br>
		<a href="https://vk.com/sandmangame" target="_blank">Vk</a>
	</p>
  </body>
</html>